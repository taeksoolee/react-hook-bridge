{"version":3,"file":"index.cjs.js","sources":["../src/useChildWindow.ts","../src/useParentWindow.ts"],"sourcesContent":["import { useEffect, useState } from 'react';\nimport { MESSAGE_KEY, TYPE_KEY } from './constaints';\n\ninterface UseChildWindowParams<T> {\n  bridgeKey: string;\n  connectUrl: string;\n  callback: (data: T) => void;\n}\n\ninterface Log<T> {\n  date : Date;\n  message: T;\n}\n\nexport function useChildWindow<T>({\n  bridgeKey, // requirement\n  connectUrl, // requirement\n  callback, // (data) => void \n}: UseChildWindowParams<T>) {\n  // const _window = useRef();\n  const [logs, setLogs] = useState<Log<T>[]>([]);\n\n  useEffect(() => {\n    const opener = window.opener;\n    // _window.current = opener;\n    opener.postMessage({[TYPE_KEY]: bridgeKey}, connectUrl);\n\n    const handler = (e: MessageEvent) => {\n      if(e.origin === connectUrl) {\n        const data = e.data[MESSAGE_KEY];\n        callback && callback(data);\n\n        setLogs([\n          ...logs, {date: new Date(), message: data},\n        ]);\n      }\n    };\n\n    window.addEventListener('message', handler);\n    return () => {\n      window.removeEventListener('message', handler);\n    }\n  }, []);\n\n  return [ logs ];\n}","import { useEffect, useRef } from 'react';\nimport { MESSAGE_KEY, TYPE_KEY } from './constaints';\n\ninterface UseParentWindowParams<T> {\n  bridgeKey: string;\n  connectUrl: string;\n  getData: () => T;\n};\n\nexport function useParentWindow<T>({\n  bridgeKey, // requirement\n  connectUrl, // requirement\n  getData, \n}: UseParentWindowParams<T>) {\n  // !getData && console.warn('useParentWindow : getData in params is undefeined');\n  // !connectUrl && console.warn('useParentWindow : connectUrl in params is undefeined');\n\n  // bridgeKey = bridgeKey || 'bridgeKey';\n\n  const _window = useRef<Window | null>(null);\n\n  const open = () => {\n    _window.current = window.open(connectUrl);\n  }\n\n  const close = () => {\n    _window.current?.close();\n  }\n\n  useEffect(() => {\n    const handler = (e: MessageEvent) => {\n      e.origin === connectUrl \n        && e.data[TYPE_KEY] === bridgeKey\n          && getData && _window.current?.postMessage({[MESSAGE_KEY]: getData()}, connectUrl);\n    };\n\n    window.addEventListener('message', handler);\n    return () => {\n      window.removeEventListener('message', handler);\n    }\n  }, []);\n\n  return [ open, close ];\n}"],"names":["bridgeKey","connectUrl","callback","logs","setLogs","useState","useEffect","window","opener","postMessage","type","handler","e","origin","data","date","Date","message","addEventListener","removeEventListener","getData","_window","useRef","current","_a","bridge","open","close"],"mappings":"4HAckCA,UAChCA,EAASC,WACTA,EAAUC,SACVA,IAGA,MAAOC,EAAMC,GAAWC,EAAQA,SAAW,IAwB3C,OAtBAC,EAAAA,WAAU,KACOC,OAAOC,OAEfC,YAAY,CAACC,KAAYV,GAAYC,GAE5C,MAAMU,EAAWC,IACf,GAAGA,EAAEC,SAAWZ,EAAY,CAC1B,MAAMa,EAAOF,EAAEE,KAAgB,OAC/BZ,GAAYA,EAASY,GAErBV,EAAQ,IACHD,EAAM,CAACY,KAAM,IAAIC,KAAQC,QAASH,OAM3C,OADAP,OAAOW,iBAAiB,UAAWP,GAC5B,KACLJ,OAAOY,oBAAoB,UAAWR,MAEvC,IAEI,CAAER,sCCnCwBH,UACjCA,EAASC,WACTA,EAAUmB,QACVA,IAOA,MAAMC,EAAUC,SAAsB,MAuBtC,OAbAhB,EAAAA,WAAU,KACR,MAAMK,EAAWC,UACfA,EAAEC,SAAWZ,GACRW,EAAEE,KAAa,OAAMd,GACnBoB,IAA4B,UAAjBC,EAAQE,eAAS,IAAAC,GAAAA,EAAAf,YAAY,CAACgB,OAAeL,KAAYnB,KAI7E,OADAM,OAAOW,iBAAiB,UAAWP,GAC5B,KACLJ,OAAOY,oBAAoB,UAAWR,MAEvC,IAEI,CArBM,KACXU,EAAQE,QAAUhB,OAAOmB,KAAKzB,IAGlB,WACK,QAAjBuB,EAAAH,EAAQE,eAAS,IAAAC,GAAAA,EAAAG"}